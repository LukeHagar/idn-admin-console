import{s as C,f as h,a as D,g as b,h as S,S as E,c as T,d as $,j as y,i as P,A as v,o as j,z as q}from"../chunks/scheduler.10bc074a.js";import{S as A,i as F,t as _,c as J,a as g,g as M,b as w,d as x,m as N,e as O}from"../chunks/index.7b3d626a.js";import{g as V}from"../chunks/stores.dc566077.js";import"../chunks/ProgressBar.svelte_svelte_type_style_lang.ae9fcbec.js";import{t as k,T as I}from"../chunks/Table.f5db4492.js";import{a as R}from"../chunks/alasql.min.1f65b74d.js";import{P as L}from"../chunks/Progress.f79dd2c2.js";function z(c){let t,r;return t=new L({}),{c(){w(t.$$.fragment)},l(e){x(t.$$.fragment,e)},m(e,l){N(t,e,l),r=!0},p:q,i(e){r||(g(t.$$.fragment,e),r=!0)},o(e){_(t.$$.fragment,e),r=!1},d(e){O(t,e)}}}function B(c){let t,r;return t=new I({props:{class:"w-full",source:c[0],interactive:!0}}),t.$on("selected",c[1]),{c(){w(t.$$.fragment)},l(e){x(t.$$.fragment,e)},m(e,l){N(t,e,l),r=!0},p(e,l){const i={};l&1&&(i.source=e[0]),t.$set(i)},i(e){r||(g(t.$$.fragment,e),r=!0)},o(e){_(t.$$.fragment,e),r=!1},d(e){O(t,e)}}}function G(c){let t,r,e,l="Listing of Source Account Create Errors",i,o,a,u;const p=[B,z],s=[];function d(n,f){return n[0]?0:1}return o=d(c),a=s[o]=p[o](c),{c(){t=h("div"),r=h("div"),e=h("div"),e.textContent=l,i=D(),a.c(),this.h()},l(n){t=b(n,"DIV",{class:!0});var f=S(t);r=b(f,"DIV",{class:!0});var m=S(r);e=b(m,"DIV",{class:!0,"data-svelte-h":!0}),E(e)!=="svelte-1r17rra"&&(e.textContent=l),i=T(m),a.l(m),m.forEach($),f.forEach($),this.h()},h(){y(e,"class","text-2xl text-center py-2"),y(r,"class","flex justify-center mt-4 flex-col align-middle"),y(t,"class","p-4")},m(n,f){P(n,t,f),v(t,r),v(r,e),v(r,i),s[o].m(r,null),u=!0},p(n,[f]){let m=o;o=d(n),o===m?s[o].p(n,f):(M(),_(s[m],1,1,()=>{s[m]=null}),J(),a=s[o],a?a.p(n,f):(a=s[o]=p[o](n),a.c()),g(a,1),a.m(r,null))},i(n){u||(g(a),u=!0)},o(n){_(a),u=!1},d(n){n&&$(t),s[o].d()}}}function U(c,t,r){const e=V();let l,i;j(async()=>{if(i=await(await fetch("/api/sailpoint/search",{method:"POST",body:JSON.stringify({indices:["events"],query:{query:'name: "Create Account Failed" AND created: [now-90d TO now]'},sort:["created"]}),headers:{"content-type":"application/json"}})).json(),JSON.stringify(i)!=="{}"){let p=[];for(let d of i)p.push({name:d.target.name,source:d.attributes.sourceName,failure:d.name});let s=R("SELECT failure, source, name, count(*) as failures FROM ? GROUP BY failure, source, name",[p]);console.log(s),r(0,l={head:["Name","Source","Failure","Number Failures"],body:k(s,["name","source","failure","failures"]),meta:k(s,["name","source","failure","failures"])})}});function o(a){console.log(a);let u="";for(let s of i)s.target.name==a.detail[0]&&s.attributes.sourceName==a.detail[1]&&s.name==a.detail[2]&&(console.log(s.attributes.errors),u=JSON.stringify(JSON.parse(s.attributes.errors),null,"  "));const p={type:"alert",title:"Exception Details",body:`${u}`};e.trigger(p)}return[l,o]}class ee extends A{constructor(t){super(),F(this,t,U,G,C,{})}}export{ee as component};
